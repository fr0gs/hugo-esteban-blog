<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Routing in Javascript - Esteban Sastre</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Routing in Javascript" />
<meta property="og:description" content="Old web applications generated a new html document per each state change. Single Page Applications use javascript routing to simulate state changes in a single document." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/routing-in-javascript/" />
<meta property="article:published_time" content="2017-08-05T13:31:50+00:00" />
<meta property="article:modified_time" content="2017-08-05T13:31:50+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Routing in Javascript"/>
<meta name="twitter:description" content="Old web applications generated a new html document per each state change. Single Page Applications use javascript routing to simulate state changes in a single document."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" /><link rel="stylesheet" type="text/css" href="/css/dark.css" media="(prefers-color-scheme: dark)" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="/">
				<img src="wizard.png" alt="Esteban Sastre" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="/">Esteban Sastre</a></h1>
	<div class="site-description"><p>Pretty much everything that crosses my mind, thoughts and ramblings</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fr0gs/" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">05</span>
							<span class="rest">Aug 2017</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Routing in Javascript</h1>
				</div>
			</div>
					
			<div class="markdown">
				<h1 id="introduction">Introduction</h1>
<p>Originally web applications consisted in interconnected html documents that one could navigate through links between them. Every time a user clicked a link on a website a new  document would be generated in the server and sent back to the browser to be rendered in their screen.</p>
<p>Around the year 2005 the term <em>Single-Page Application (SPA)</em> became popular. Said term encompassed a new way or architecting websites to make them behave more like desktop applications: snappy, with graphical animations and smooth transitions between links.
This was achieved by taking advantage of javascript, html &amp; css, as new APIs became available to give the browser more native-like capabilities.</p>
<p><strong>SPAs</strong> are based on a single document model. This means that web applications&rsquo; lifespan happens on a single html page, along with the transitions between the different views. But since links no longer imply the fetching and generation of a new document, how are those transitions modelled? they are achieved by using a <strong>router</strong>.</p>
<h1 id="what-is-a-javascript-router">What is a Javascript Router?</h1>
<p>A Javascript router is a key component in most frontend frameworks. It is the piece of software in charge to organize the states of the application, switching between different views. For example, the router will render the login screen initially, and when the login is successfull it will perform the transition to the user's welcome screen.</p>
<h1 id="how-it-works">How it works.</h1>
<p>The router will be in charge of simulating transitions between documents by watching changes on the URL. When the document is reloaded or the URL is modified somehow, it will detect that change and render the view that is associated with the new URL.</p>
<p>I wrote a small router in javascript to illustrate the idea. At the beginning we need two objects, one to store the routes, and other to store the templates, along with two simple functions to register them.</p>
<p><em>Templates</em> are just one way of describing the DOM that will be generated when the transition from one route to the other is completed. The whole javascript application will live in a div element.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#008000">// Application div
</span><span style="color:#008000"></span><span style="color:#00f">const</span> appDiv = <span style="color:#a31515">&#34;app&#34;</span>;

<span style="color:#008000">// Both set of different routes and template generation functions
</span><span style="color:#008000"></span><span style="color:#00f">let</span> routes = {};
<span style="color:#00f">let</span> templates = {};

<span style="color:#008000">// Register a template (this is to mimic a template engine)
</span><span style="color:#008000"></span><span style="color:#00f">let</span> template = (name, templateFunction) =&gt; {
  <span style="color:#00f">return</span> templates[name] = templateFunction;
};

<span style="color:#008000">// Define the routes. Each route is described with a route path &amp; a template to render
</span><span style="color:#008000"></span><span style="color:#008000">// when entering that path. A template can be a string (file name), or a function that
</span><span style="color:#008000"></span><span style="color:#008000">// will directly create the DOM objects.
</span><span style="color:#008000"></span><span style="color:#00f">let</span> route = (path, template) =&gt; {
    <span style="color:#00f">if</span> (<span style="color:#00f">typeof</span> template == <span style="color:#a31515">&#34;function&#34;</span>) {
      <span style="color:#00f">return</span> routes[path] = template;
    }
    <span style="color:#00f">else</span> <span style="color:#00f">if</span> (<span style="color:#00f">typeof</span> template == <span style="color:#a31515">&#34;string&#34;</span>) {
      <span style="color:#00f">return</span> routes[path] = templates[template];
    }
    <span style="color:#00f">else</span> {
      <span style="color:#00f">return</span>;
    }
};
</code></pre></div><p>Now we will be able to register templates and routes, creating the mapping between them:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#008000">// Register the templates.
</span><span style="color:#008000"></span>template(<span style="color:#a31515">&#39;template1&#39;</span>, () =&gt; {
    <span style="color:#00f">let</span> myDiv = document.getElementById(appDiv);
    myDiv.innerHTML = <span style="color:#a31515">&#34;&#34;</span>;
    <span style="color:#00f">const</span> link1 = createLink(<span style="color:#a31515">&#39;view1&#39;</span>, <span style="color:#a31515">&#39;Go to view1&#39;</span>, <span style="color:#a31515">&#39;#/view1&#39;</span>);
    <span style="color:#00f">const</span> link2 = createLink(<span style="color:#a31515">&#39;view2&#39;</span>, <span style="color:#a31515">&#39;Go to view2&#39;</span>, <span style="color:#a31515">&#39;#/view2&#39;</span>);

    myDiv.appendChild(link1);
    <span style="color:#00f">return</span> myDiv.appendChild(link2);
});

template(<span style="color:#a31515">&#39;template-view1&#39;</span>, () =&gt; {
    <span style="color:#00f">let</span> myDiv = document.getElementById(appDiv);
    myDiv.innerHTML = <span style="color:#a31515">&#34;&#34;</span>;
    <span style="color:#00f">const</span> link1 = createDiv(<span style="color:#a31515">&#39;view1&#39;</span>, <span style="color:#a31515">&#34;&lt;div&gt;&lt;h1&gt;This is View 1 &lt;/h1&gt;&lt;a href=&#39;#/&#39;&gt;Go Back to Index&lt;/a&gt;&lt;/div&gt;&#34;</span>);
    <span style="color:#00f">return</span> myDiv.appendChild(link1);
});

template(<span style="color:#a31515">&#39;template-view2&#39;</span>, () =&gt; {
    <span style="color:#00f">let</span> myDiv = document.getElementById(appDiv);
    myDiv.innerHTML = <span style="color:#a31515">&#34;&#34;</span>;
    <span style="color:#00f">const</span> link2 = createDiv(<span style="color:#a31515">&#39;view2&#39;</span>, <span style="color:#a31515">&#34;&lt;div&gt;&lt;h1&gt;This is View 2 &lt;/h1&gt;&lt;a href=&#39;#/&#39;&gt;Go Back to Index&lt;/a&gt;&lt;/div&gt;&#34;</span>);
    <span style="color:#00f">return</span> myDiv.appendChild(link2);
});


<span style="color:#008000">// Define the mappings route-&gt;template.
</span><span style="color:#008000"></span>route(<span style="color:#a31515">&#39;/&#39;</span>, <span style="color:#a31515">&#39;template1&#39;</span>);
route(<span style="color:#a31515">&#39;/view1&#39;</span>, <span style="color:#a31515">&#39;template-view1&#39;</span>);
route(<span style="color:#a31515">&#39;/view2&#39;</span>, <span style="color:#a31515">&#39;template-view2&#39;</span>);
</code></pre></div><p>For the <strong>templates</strong> we match a template name with a function that will generate javascript elements and append the resulting DOM to the <strong>div</strong> where the application lives. This functionality in a real router would be taken over by the <em>templating engine</em>. For the <strong>routes</strong>, we just do the mapping between a route path and the corresponding template.</p>
<p>The <em>createLink</em> &amp; <em>createDiv</em> are auxiliary functions to generate DOM:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#008000">// Generate DOM tree from a string
</span><span style="color:#008000"></span><span style="color:#00f">let</span> createDiv = (id, xmlString) =&gt; {
    <span style="color:#00f">let</span> d = document.createElement(<span style="color:#a31515">&#39;div&#39;</span>);
    d.id = id;
    d.innerHTML = xmlString;
    <span style="color:#00f">return</span> d.firstChild;
};

<span style="color:#008000">// Helper function to create a link.
</span><span style="color:#008000"></span><span style="color:#00f">let</span> createLink = (title, text, href) =&gt; {
    <span style="color:#00f">let</span> a = document.createElement(<span style="color:#a31515">&#39;a&#39;</span>);
    <span style="color:#00f">let</span> linkText = document.createTextNode(text);
    a.appendChild(linkText);
    a.title = title;
    a.href = href;
    <span style="color:#00f">return</span> a;
};
</code></pre></div><p>What is left is to have the logic to detect changes in the URL and resolve them to render the template. To do so, listen for the <em>load</em> &amp; <em>hashchange</em> events. The former fires then a document is loaded, and the latter when the URL hash changes.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#008000">// Give the correspondent route (template) or fail
</span><span style="color:#008000"></span><span style="color:#00f">let</span> resolveRoute = (route) =&gt; {
    <span style="color:#00f">try</span> {
     <span style="color:#00f">return</span> routes[route];
    } <span style="color:#00f">catch</span> (error) {
        <span style="color:#00f">throw</span> <span style="color:#00f">new</span> Error(<span style="color:#a31515">&#34;The route is not defined&#34;</span>);
    }
};

<span style="color:#008000">// The actual router, get the current URL and generate the corresponding template
</span><span style="color:#008000"></span><span style="color:#00f">let</span> router = (evt) =&gt; {
    <span style="color:#00f">const</span> url = window.location.hash.slice(1) || <span style="color:#a31515">&#34;/&#34;</span>;
    <span style="color:#00f">const</span> routeResolved = resolveRoute(url);
    routeResolved();
};

<span style="color:#008000">// For first load or when routes are changed in browser url box.
</span><span style="color:#008000"></span>window.addEventListener(<span style="color:#a31515">&#39;load&#39;</span>, router);
window.addEventListener(<span style="color:#a31515">&#39;hashchange&#39;</span>, router);
</code></pre></div><p>That's it! Of course many functionality is lacking: the use of controllers to transform data before passing it to the views, nested routes, the use of <a href="https://developer.mozilla.org/en-US/docs/Web/API/History_API">history api</a>, etc.. but the idea of javascript routing is quite easy to grasp. The code together can be found in <a href="https://gist.github.com/fr0gs/133127ce31d73e7010ef19db874c319b">this gist</a>.</p>
<h1 id="examples">Examples</h1>
<ul>
<li><a href="https://github.com/tildeio/router.js/">tildeio/router.js</a></li>
<li><a href="https://guides.emberjs.com/v2.14.0/routing/">Ember Router</a></li>
<li><a href="https://github.com/ReactTraining/react-router">React Router</a></li>
<li><a href="https://github.com/vuejs/vue-router">Vue router</a></li>
</ul>
<h1 id="references">References</h1>
<ul>
<li><a href="http://joakim.beng.se/blog/posts/a-javascript-router-in-20-lines.html">http://joakim.beng.se/blog/posts/a-javascript-router-in-20-lines.html</a></li>
<li><a href="http://www.softfinity.com/blog/an-simple-introduction-to-url-routing/">http://www.softfinity.com/blog/an-simple-introduction-to-url-routing/</a></li>
<li><a href="http://krasimirtsonev.com/blog/article/A-modern-JavaScript-router-in-100-lines-history-api-pushState-hash-url">http://krasimirtsonev.com/blog/article/A-modern-JavaScript-router-in-100-lines-history-api-pushState-hash-url</a></li>
<li><a href="https://blog.risingstack.com/writing-a-javascript-framework-client-side-routing/">https://blog.risingstack.com/writing-a-javascript-framework-client-side-routing/</a></li>
</ul>
<p>Have fun!</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/javascript">javascript</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'ink-demo';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-99848055-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
