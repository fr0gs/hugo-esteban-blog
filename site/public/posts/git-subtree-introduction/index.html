<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Git subtree introduction - Esteban Sastre</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Git subtree introduction" />
<meta property="og:description" content="Small introduction for the git subtreee capabilities." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/git-subtree-introduction/" />
<meta property="article:published_time" content="2017-08-10T13:46:10+00:00" />
<meta property="article:modified_time" content="2017-08-10T13:46:10+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Git subtree introduction"/>
<meta name="twitter:description" content="Small introduction for the git subtreee capabilities."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" /><link rel="stylesheet" type="text/css" href="/css/dark.css" media="(prefers-color-scheme: dark)" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="/">
				<img src="wizard.png" alt="Esteban Sastre" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="/">Esteban Sastre</a></h1>
	<div class="site-description"><p>Pretty much everything that crosses my mind, thoughts and ramblings</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fr0gs/" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">10</span>
							<span class="rest">Aug 2017</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Git subtree introduction</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>[<strong>NOTE</strong>: I recovered this post from my <a href="https://deixapaso.wordpress.com/">old wordpress blog</a>]</p>
<p>We often find ourselves developing projects that depend on other vendor’s libraries or even on our own produced external software components.</p>
<p>Git subtree provides a way to incorporate that external project into another one (normally bigger) by copying it inside the parent one and making it share the parent’s commit history from that moment on.</p>
<p>This is known as system-based approach in development, where you architect your design by taking the different interconnected projects as a whole. That strategy involves tagging, merging and pushing the whole repository constantly. One commit history to rule them all.</p>
<p>How does it work? Imagine we have two projects: the big one (the-backend), and the small one (the-frontend). Former is the main project, being constantly changed and under heavy commit routine. The latter is the mobile web application that consumes the backend’s API. Stable, and only being changed every backend’s major release.</p>
<p>It is therefore interesting to manage both projects independently, with sepparate commit histories but maintaining cohesion of the project itself. One way to do it is well, with git subtrees.</p>
<p>NOTE: this is an extremely simple use case of git subtree just to get the sense of it, any corrections are more than welcome.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">the-backend/ (parent project)
   file1
   file2
 
the-frontend/ (child project)
   item1
   item2
</code></pre></div><p>Both the-backend/ and the-frontend/; are independent projects. They can be in the same server or in remote servers, only references will change.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">λ mkdir the-backend/
λ touch the-backend/file1 the-backend/file2
 
λ mkdir the-frontend/
λ touch the-frontend/item1 the-frontend/item2
</code></pre></div><p>We want to add the-frontend/ as a dependence to the-backend/ project but letting it stand as an independent repository.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">λ cd the-backend/
λ git init
λ git add .
λ git commit -a -m <span style="color:#a31515">&#34;Two first files added to the-backend parent project &#34;</span>
 
λ cd ../the-frontend/
λ git init
λ git add .
λ git commit -a -m <span style="color:#a31515">&#34;Two first files added to the-frontend child project&#34;</span>
</code></pre></div><p>Now with both repositories initialized, we add the the-frontend/ repo as a remote repo to the-backend/ project.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">λ (In the-backend/ folder)
λ git remote add frontend-subtree ../the-frontend/
λ git subtree add --prefix=frontend frontend-subtree master
Creates a subtree of the-frontend/ project inside the-backend/ project under the prefix specified (prefix obligatory)
</code></pre></div><p>Now if we <code>git log</code> inside the-backend/ we see a commit message something like: “Add ‘the-frontend/’ from commit <!-- raw HTML omitted -->”.
Say that now we want to add some changes in the-frontend/ project outside the-backend/ one.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">λ (In the-frontend/ folder, not the-backend/frontend/)
λ touch item3
λ git add item3 &amp;&amp; git commit item3 -m <span style="color:#a31515">&#34;Item3 added inside the-frontend/ outside project.&#34;</span>
λ git log
* c557ce6 - (HEAD, master) Item3 added inside the-frontend/ outside project. (4 seconds ago) &lt;Esteban&gt;
* 45074d3 - Two first files added to the-frontend child project (4 days ago) &lt;Esteban&gt;
</code></pre></div><p>However this changes are only visible in the-frontend/ project, while in the-backend/frontend/..</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">λ ls the-backend/frontend
item1 item2
 
λ git log
* e009438 - (HEAD, master) Add <span style="color:#a31515">&#39;the-frontend/&#39;</span> from commit <span style="color:#a31515">&#39;45074d397c99079acd20cb24e9d8b8830afcf802&#39;</span> (4 days ago) &lt;Esteban&gt;
|<span style="color:#a31515">\
</span><span style="color:#a31515"></span>| * 45074d3 - (frontend-subtree/master) Two first files added to the-frontend child project (4 days ago) &lt;Esteban&gt;
* 3ea1a67 - Two first files added to the-backend parent project (4 days ago) &lt;Esteban&gt;
</code></pre></div><p>If we want those changes visible in the-backend/frontend/ subtree folder, we have to git pull subtree:</p>
<p>In the-backend/ root folder, above frontend/, otherwise we get a message like &lsquo;You need to run this command from the toplevel of the working tree.')</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">λ git subtree pull --prefix=frontend/ frontend-subtree master
λ git log
 
* 7dd7677 - (HEAD, master) Merge commit from the parent the-backend/ pulling changes from the the-frontend/ subtree (28 seconds ago) &lt;Esteban&gt;
|<span style="color:#a31515">\
</span><span style="color:#a31515"></span>| * c557ce6 - (frontend-subtree/master) Item3 added inside the-frontend/ outside project. (6 minutes ago) &lt;Esteban&gt;
* | e009438 - Add <span style="color:#a31515">&#39;the-frontend/&#39;</span> from commit <span style="color:#a31515">&#39;45074d397c99079acd20cb24e9d8b8830afcf802&#39;</span> (4 days ago) &lt;Esteban&gt;
|<span style="color:#a31515">\ </span><span style="color:#a31515">\
</span><span style="color:#a31515"></span>| |/
| * 45074d3 - Two first files added to the-frontend/ child project (4 days ago) &lt;Esteban&gt;
* 3ea1a67 - Two first files added to the-backend/ parent project (4 days ago) &lt;Esteban&gt;
</code></pre></div><p>See also how we got into the-backend/ parent folder the local commit from the-frontend/ repository. This may be also avoided adding the –squash option in the git subtree pull command. That option will compress all local commits in one single commit for the subtree pull.</p>
<p>Nonetheless, we might aswell do it inversely. If someone working from the parent the-backend/ folder makes a change to the frontend/ added subtree, and we want to see those changes reflected in the outsider the-frontend/ repository:</p>
<p>(In the-backed/frontend)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">λ touch item4_from_parent
λ git add &amp;&amp; git commit item4_from_parent -m <span style="color:#a31515">&#34;Item4 added from the parent to frontend/ subtree folder&#34;</span>
λ git log
* 4a50c88 - (HEAD, master) Item4 added from the parent to frontend/ subtree folder (9 seconds ago)
( . . . )
λ git subtree push --prefix=frontend/ frontend-subtree new-branch-from-master
</code></pre></div><p>This will create a new branch in the-frontend/ project with those changes. It is extremely cumbersome to create a new branch in the frontend external project every time a change is made in the subtree from the parent, but git subtree does not allow to overwrite the master branch by default due to potential inconsistent state restrictions.</p>
<p>One alternative to git subtree is git submodules,  but that is topic for another article.</p>
<p>Links:</p>
<p><a href="https://stackoverflow.com/questions/31769820/differences-between-git-submodule-and-subtree">https://stackoverflow.com/questions/31769820/differences-between-git-submodule-and-subtree</a>
<a href="https://stackoverflow.com/questions/769786/vendor-branches-in-git/769941#769941">https://stackoverflow.com/questions/769786/vendor-branches-in-git/769941#769941</a>
<a href="https://git-scm.com/book/en/v1/Git-Tools-Subtree-Merging">https://git-scm.com/book/en/v1/Git-Tools-Subtree-Merging</a>
<a href="https://developer.atlassian.com/blog/2015/05/the-power-of-git-subtree/">https://developer.atlassian.com/blog/2015/05/the-power-of-git-subtree/</a></p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/git">git</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'ink-demo';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-99848055-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
