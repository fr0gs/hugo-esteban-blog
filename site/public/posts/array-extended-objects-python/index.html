<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Array of extended objects in python using list comprehensions and lambda functions. - Esteban Sastre</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Array of extended objects in python using list comprehensions and lambda functions." />
<meta property="og:description" content="Problem It&#39;s been a while since I don&#39;t write any posts, so I thought that even though the idea might be initially quite silly, it will help me to kickoff again the habit by writing about a small problem I encountered the other day.
I was developing a very simple microservice that would receive a GET request with two parameters, issue a SPARQL query to a Virtuoso store and then, transform the returned array of objects by extending each object with the same additional meta information per object." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/array-extended-objects-python/" />
<meta property="article:published_time" content="2017-12-04T20:39:40+00:00" />
<meta property="article:modified_time" content="2017-12-04T20:39:40+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Array of extended objects in python using list comprehensions and lambda functions."/>
<meta name="twitter:description" content="Problem It&#39;s been a while since I don&#39;t write any posts, so I thought that even though the idea might be initially quite silly, it will help me to kickoff again the habit by writing about a small problem I encountered the other day.
I was developing a very simple microservice that would receive a GET request with two parameters, issue a SPARQL query to a Virtuoso store and then, transform the returned array of objects by extending each object with the same additional meta information per object."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" /><link rel="stylesheet" type="text/css" href="/css/dark.css" media="(prefers-color-scheme: dark)" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="/">
				<img src="wizard.png" alt="Esteban Sastre" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="/">Esteban Sastre</a></h1>
	<div class="site-description"><p>Pretty much everything that crosses my mind, thoughts and ramblings</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fr0gs/" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">04</span>
							<span class="rest">Dec 2017</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Array of extended objects in python using list comprehensions and lambda functions.</h1>
				</div>
			</div>
					
			<div class="markdown">
				<h2 id="problem">Problem</h2>
<p>It's been a while since I don't write any posts, so I thought that even though the idea might be initially quite silly, it will help me to kickoff again the habit by writing about a small problem I encountered the other day.</p>
<p>I was developing a very simple microservice that would receive a <em>GET</em> request with two parameters, issue a <em>SPARQL</em> query to a <strong>Virtuoso</strong> store and then, transform the returned array of objects by extending each object with the same additional meta information per object. Say:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">res = [{ <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">title</span><span style="color:#a31515">&#39;</span>: <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">Oh boy</span><span style="color:#a31515">&#39;</span> }, { <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">title</span><span style="color:#a31515">&#39;</span>: <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">Oh girl</span><span style="color:#a31515">&#39;</span>}]
</code></pre></div><p>And then add some additional metadata like <code>{ 'meta': { 'author': 'Myself'}}</code></p>
<p>Ending up with</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">res = [ {
        <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">title</span><span style="color:#a31515">&#39;</span>: <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">Oh boy</span><span style="color:#a31515">&#39;</span>,
        <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">meta</span><span style="color:#a31515">&#39;</span>:  {
          <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">author</span><span style="color:#a31515">&#39;</span>: <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">Myself</span><span style="color:#a31515">&#39;</span>
          }
        },
        {
          <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">title</span><span style="color:#a31515">&#39;</span>: <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">Oh girl</span><span style="color:#a31515">&#39;</span>,
          <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">meta</span><span style="color:#a31515">&#39;</span>: {
            <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">author</span><span style="color:#a31515">&#39;</span>: <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">Myself</span><span style="color:#a31515">&#39;</span>
          }
        }]
</code></pre></div><h2 id="solution">Solution</h2>
<p>I wanted to do something self contained and as functional as possible, by using list comprehensions for example. Unfortunately, there is no method in python to update a dictionary and return the new dictionary updated. The regular way is like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">a = { <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">b</span><span style="color:#a31515">&#39;</span>: 3 }
a.update({<span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">c</span><span style="color:#a31515">&#39;</span>: 5}) <span style="color:#008000"># Dict updated, does not return anything</span>
<span style="color:#00f">print</span>(a) <span style="color:#008000"># {&#39;c&#39;: 5, &#39;b&#39;: 3}</span>
</code></pre></div><p>Ultimately I came up with a small solution:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">result = [(<span style="color:#00f">lambda</span> x, y=z.copy(): (y.update(x), y))({ <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">meta</span><span style="color:#a31515">&#39;</span>: { <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">author</span><span style="color:#a31515">&#39;</span>: <span style="color:#a31515"></span><span style="color:#a31515">&#39;</span><span style="color:#a31515">Myself</span><span style="color:#a31515">&#39;</span> } })[1] <span style="color:#00f">for</span> z <span style="color:#00f">in</span> res]
</code></pre></div><p>Tada! Combining list comprehensions, lambda functions and the built-in dictionary <strong>copy()</strong> function we can return a new array with a copy of each object already extended.</p>
<p>By using a lambda function that accepts a tuple we can specify that the first argument is passed as a parameter and the second one will be a copy of each element in the array (assuming it is an object). Then, the object is extended with the argument and the newly extended object is returned as the second element of the tuple.</p>
<p>We could even bake this into a function:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00f">def</span> map_extend(array=[], ext={}):
  <span style="color:#00f">return</span> [(<span style="color:#00f">lambda</span> x, y=z.copy(): (y.update(x), y))(ext)[1] <span style="color:#00f">for</span> z <span style="color:#00f">in</span> array]
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt;&gt;&gt; res
[{<span style="color:#a31515">&#39;title&#39;</span>: <span style="color:#a31515">&#39;Oh boy&#39;</span>}, {<span style="color:#a31515">&#39;title&#39;</span>: <span style="color:#a31515">&#39;Oh girl&#39;</span>}]
&gt;&gt;&gt; ext = { <span style="color:#a31515">&#39;meta&#39;</span>: {<span style="color:#a31515">&#39;author&#39;</span>: <span style="color:#a31515">&#39;Hola&#39;</span>}}                                                     
&gt;&gt;&gt; map_extend(res, ext)
[{<span style="color:#a31515">&#39;meta&#39;</span>: {<span style="color:#a31515">&#39;author&#39;</span>: <span style="color:#a31515">&#39;Hola&#39;</span>}, <span style="color:#a31515">&#39;title&#39;</span>: <span style="color:#a31515">&#39;Oh boy&#39;</span>}, {<span style="color:#a31515">&#39;meta&#39;</span>: {<span style="color:#a31515">&#39;author&#39;</span>: <span style="color:#a31515">&#39;Hola&#39;</span>}, <span style="color:#a31515">&#39;title&#39;</span>: <span style="color:#a31515">&#39;Oh girl&#39;</span>}]
&gt;&gt;&gt; map_extend(res, {})                                                                     
[{<span style="color:#a31515">&#39;title&#39;</span>: <span style="color:#a31515">&#39;Oh boy&#39;</span>}, {<span style="color:#a31515">&#39;title&#39;</span>: <span style="color:#a31515">&#39;Oh girl&#39;</span>}]
&gt;&gt;&gt; map_extend([], {})                                                                      
[]
</code></pre></div><p>Have fun!</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/python">python</a></li>
							
							<li><a href="/tags/list-comprehensions">list-comprehensions</a></li>
							
							<li><a href="/tags/lambda-functions">lambda functions</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'ink-demo';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-99848055-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
