<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Oh no, I forgot my PGP private key&#39;s passphrase - Esteban Sastre</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Oh no, I forgot my PGP private key&#39;s passphrase" />
<meta property="og:description" content="Introduction After being quite disconnected from the technology world for months and pretty much limiting my interactions to my working schedule, I decided to go back into setting up my personal workstation with the minimal memory footprint and using as little privacy-invading technologies as possible.
One step of this process meant setting up again my GPG keys to be used while signing my emails. Thus, I retrieve my private key from an offline medium I keep safe and check whether the corresponding generated public key matches the one I have broadcasted publicly." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/oh-no-i-forgot-my-private-keys-passphrase/" />
<meta property="article:published_time" content="2019-04-14T19:12:43+00:00" />
<meta property="article:modified_time" content="2019-04-14T19:12:43+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Oh no, I forgot my PGP private key&#39;s passphrase"/>
<meta name="twitter:description" content="Introduction After being quite disconnected from the technology world for months and pretty much limiting my interactions to my working schedule, I decided to go back into setting up my personal workstation with the minimal memory footprint and using as little privacy-invading technologies as possible.
One step of this process meant setting up again my GPG keys to be used while signing my emails. Thus, I retrieve my private key from an offline medium I keep safe and check whether the corresponding generated public key matches the one I have broadcasted publicly."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" /><link rel="stylesheet" type="text/css" href="/css/dark.css" media="(prefers-color-scheme: dark)" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="/">
				<img src="wizard.png" alt="Esteban Sastre" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="/">Esteban Sastre</a></h1>
	<div class="site-description"><p>Pretty much everything that crosses my mind, thoughts and ramblings</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fr0gs/" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">14</span>
							<span class="rest">Apr 2019</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Oh no, I forgot my PGP private key&#39;s passphrase</h1>
				</div>
			</div>
					
			<div class="markdown">
				<h2 id="introduction">Introduction</h2>
<p>After being quite disconnected from the technology world for months and pretty much limiting my interactions to my working schedule, I decided to go back into setting up my personal workstation with the minimal memory footprint and using as little privacy-invading technologies as possible.</p>
<p>One step of this process meant setting up again my GPG keys to be used while signing my emails. Thus, I retrieve my private key from an offline medium I keep safe and check whether the corresponding generated public key matches the one I have broadcasted publicly. (like here in <a href="https://estebansastre.com/about">https://estebansastre.com/about</a>)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">.ssh λ ssh-keygen -y -e -f secret-key.asc
Enter passphrase:
</code></pre></div><p>I try every single password combination I can think of and nothing. <strong>F*ck</strong>. So, what do I do now?</p>
<h2 id="steps-to-take">Steps to take</h2>
<h3 id="1-identify-where-is-my-public-key-available">1. Identify where is my public key available.</h3>
<p>When a user creates a new key pair, they can choose to publish the public key to what is called a <a href="https://en.wikipedia.org/wiki/Key_server_%28cryptographic%29">key server</a>, which is one or a group of computers on the  internet in charge of making them available for other users to send encrypted messages.</p>
<p>By default, the <strong>GPG</strong> application uploads them to <code>keys.gnupg.net</code>. This doesn't mean that a key is in a single computer. Servers normally take part in pools and synchronize their databases, say for example the <a href="https://sks-keyservers.net/">SKS</a> or the <a href="https://keyserver.pgp.com/vkd/GetWelcomeScreen.event">PGP Global Directory</a></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">.ssh λ gpg --search-keys esteban.s.f0@gmail.com
gpg: searching <span style="color:#00f">for</span> <span style="color:#a31515">&#34;esteban.s.f0@gmail.com&#34;</span> from hkp server keys.gnupg.net
(1)     Esteban &lt;esteban.s.f0@gmail.com&gt;
          4096 bit RSA key 1E117998, created: 2018-05-07, expires: 2023-05-06
</code></pre></div><p>Taking a look at the first page of google of available keyservers, I see my key has been replicated into pretty much all of them.</p>
<ul>
<li><a href="https://pgp.key-server.io/pks/lookup?search=esteban.s.f0%40gmail.com&amp;fingerprint=on&amp;op=vindex">https://pgp.key-server.io</a></li>
<li><a href="https://pgp.mit.edu/pks/lookup?search=esteban.s.f0%40gmail.com&amp;op=index">https://pgp.mit.edu</a></li>
<li><a href="http://keys.gnupg.net/pks/lookup?search=esteban.s.f0%40gmail.com&amp;fingerprint=on&amp;op=index">http://keys.gnupg.net</a> (The default gpg's one)</li>
</ul>
<h3 id="2-create-revocation-certificate-for-the-keys">2. Create revocation certificate for the keys.</h3>
<p>Since I forgot my private key's passphrase, it is safe to assume it is equivalent to it being compromised and must no longer be taken into account for sending messages with the public key or verify any signature. The next step to take is generating a revocation certificate and upload it to the keyserver, then until it synchronizes and invalidates the other ones:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">.ssh λ gpg --output revocation-certificate.asc --gen-revoke 1E117998

sec  4096R/1E117998 2018-05-07 Esteban &lt;esteban.s.f0@gmail.com&gt;

(..etc..)

You need a passphrase to unlock the secret key <span style="color:#00f">for</span>
user: <span style="color:#a31515">&#34;Esteban &lt;esteban.s.f0@gmail.com&gt;&#34;</span>
4096-bit RSA key, ID 1E117998, created 2018-05-07

Enter passphrase: 

</code></pre></div><p><strong>F*ck</strong>, again. So, I need to know my passphrase in order to create the revocation certificate in order to revoke the private key I had initially forgotten the passphrase to. What are the options I have left?</p>
<h3 id="3-generate-new-key-pair">3. Generate new key pair</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">.ssh λ gpg2 --full-gen-key
</code></pre></div><p>And this time do remember the passphrase!</p>
<h3 id="4-generate-revocation-certificate">4. Generate revocation certificate</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">.ssh λ gpg2 --output revocation-certificate.asc --gen-revoke 38DF1841
</code></pre></div><h3 id="5-export-private-key">5. Export private key</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">.ssh λ gpg2 --armor --export-secret-keys 38DF1841 &gt; myprivkey_38DF1841.priv
</code></pre></div><p>The <code>--armor</code> option allows the private key to be encoded in plain text and thus it can be sent over an email for example.</p>
<h3 id="6-save-both-private-key--revocation-certificate">6. Save both private key &amp; revocation certificate</h3>
<p>Now I have created the new key pair, added to my keyring and successfully exported the private key along with the revocation certificate I need to store them somewhere safe and accessible offline.</p>
<h3 id="7-upload-again-my-new-public-key-to-public-keyserver">7. Upload again my new public key to public keyserver</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">.ssh λ gpg2 --send-keys 38DF1841
gpg: sending key 38DF1841 to hkp://keys.gnupg.net
</code></pre></div><!-- raw HTML omitted -->
<h3 id="8-change-my-public-key-my-own-website-estebansastrecom">8. Change my public key my own website: <em>estebansastre.com</em>.</h3>
<!-- raw HTML omitted -->
<h2 id="conclusions">Conclusions</h2>
<p>PGP is a very valuable tool to encrypt your communications, but it comes with the never ending hassle of key management. I have now four takeaways for the next time:</p>
<ul>
<li>Every time you generate a new key pair, automatically generate the revocation certificate with it just in case.</li>
<li>Always keep your private key &amp; revocation certificate in a safe place.</li>
<li>Don't forget your passphrase&hellip;</li>
<li>Use a password manager once and for all. I've heard great things about <a href="https://www.passwordstore.org/">pass</a>.</li>
</ul>
<p>Have fun!</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://debian-administration.org/article/450/Generating_a_revocation_certificate_with_gpg">https://debian-administration.org/article/450/Generating_a_revocation_certificate_with_gpg</a></li>
<li><a href="https://superuser.com/questions/227991/where-to-upload-pgp-public-key-are-keyservers-still-surviving#228033">https://superuser.com/questions/227991/where-to-upload-pgp-public-key-are-keyservers-still-surviving#228033</a></li>
<li><a href="https://blog.eleven-labs.com/en/openpgp-almost-perfect-key-pair-part-1/">https://blog.eleven-labs.com/en/openpgp-almost-perfect-key-pair-part-1/</a></li>
</ul>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/learning">learning</a></li>
							
							<li><a href="/tags/pgp">pgp</a></li>
							
							<li><a href="/tags/privacy">privacy</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'ink-demo';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-99848055-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
